---
title: "Are You Board Yet?"
subtitle: "STA/ISS 313 - Project 1"
author: "Marvel Cinematic Tidyverse"
format: html
editor: visual
execute:
  echo: false
  warning: false
---

## Abstract


In our project, we sought to determine whether there were any interesting trends within the TidyTuesday Board Games dataset. We want to know if games with higher differences between the minimum number and the maximum number of players tend to be more highly rated as well as how the number of expansions for board games changed over time, and whether or not they have had an impact on game ownership. To answer the first question, we utilized a scatterplot, line graph, and heatmap, finding that there was a weak relationship between the differential and the ratings of the respective board game.  To answer the second question, we used a path diagram, which indicated that the number of expansions and the average rating of newly-released games were both increasing over time, and a series of boxplots, which told us that games with more expansions generally had higher ownership than those with fewer expansions.

------------------------------------------------------------------------

```{r}
#| label: load-packages
#| include: false

library(tidyverse)

```

```{r}
#| label: load-data
#| include: false
#| message : false

ratings <- read_csv('data/ratings.csv')
details <- read_csv('data/details.csv')
comprehensive <- full_join(details, ratings, by = "id") |>
  filter(owned > 500) |>
  select(-num.x, -num.y, -year, -name)
```

## Introduction

The Board Games Tidy Tuesday dataset, published on January 25th, 2022, was originally collected from [Kaggle](https://www.kaggle.com/datasets/jvanelteren/boardgamegeek-reviews?select=2022-01-08.csv). It combines board game descriptions and reviews from [Board Game Geek](https://www.boardgamegeek.com/), which is an online community for board gaming hobbyists.

With `r nrow(comprehensive)` board games, the data set includes `r ncol(comprehensive)` characteristics: `r names(comprehensive)`.

## Question 1: Are games that allow wider ranges of players more highly rated?

### Introduction

Do games with larger differentials in player counts (e.g. can support a wider range of players) tend to be more highly rated? We wanted to analyze this question because it seems intuitive that games with a wider range of player counts are easier to play in social settings like parties or small gatherings, but we weren't sure whether it had any effect on the game's perception (rating).

This first question of interest will utilize the variables in the data set that represent the minimum number of players, the maximum number of players, and average rating. We're interested in this question because we're curious whether games that accommodate a wider number of people receive higher ratings generally or not. This could suggest that players enjoy and value the option to include more players in their game.

### Approach

To address this question, the first plot we made visualizes how the rating changes as the differential between the maximum and minimum number of players increases. The differential is plotted on the x-axis and the rating is plotted on the y-axis. A scatterplot is most effective in displaying all the points in order to show the audience that the majority of board games have differentials of around 0 to 5 players. We combined this with a line graph because incorporating a line connecting the average rating for each differential more clearly and immediately suggests the lack of relationship between the variables of interest.

We also created a heatmap to visualize the average rating of a game based on both the minimum and the maximum number of players. The minimum number of players is plotted on the x-axis and the maximum number of players is plotted on the y-axis with the average rating as the fill for the heatmap. The darker red the fill, the higher the average rating was for the game at that coordinate. We zoomed into the map with limits of x = (1,5) and y = (1,7) because there was not much data beyond that range. The heatmap displays similar data to the scatterplot created before, but it is still useful to support our observations in the scatterplot. A heatmap allows us to visualize minimum players, maximum players, and the average rating without creating a differential variable. This way, we do not lose information about the maximum and minimum number of players, while still gleaning information about the interaction between the two.

### Analysis

```{r}
#| label: fig-scatter-plot-question-1

#data preparation 
#filter data for differentials between 0 and 25 
#create new variable for average rating for each differential 
comprehensive_plot1 <- comprehensive |>
  mutate(
    differential = maxplayers-minplayers
  ) |>
  filter(differential >= 0 & differential < 25) |>
  group_by(differential) |>
  mutate(
    average_rating = mean(average)
  )

#plotting each differential and its average rating with a scatter plot 
#adding layer of a line that connects each average rating per differential 
ggplot(comprehensive_plot1, aes(x=differential, y = average_rating)) +
    geom_jitter(
      colour = "gray",
      alpha = .6,
    aes(x=differential,
          y = average),
         show.legend = FALSE) +
    geom_line(
      linetype = 2,
      colour = "#FFCCCB"
      ) +
    geom_point(
      colour = "red"
    ) +
    scale_x_continuous(breaks = seq(0,25,5), minor_breaks = c(0:25)) +
    scale_y_continuous(breaks = seq(2,10,1), minor_breaks = seq(2,10,.5)) +
    labs(
      x = "Differential",
      y = "Rating",
      title = "Average Rating as Differential Increases ",
      subtitle = "Suggests Minimal Relationship") +
    theme_minimal()

```

```{r}
#| label: heat-map-question-1

#just for consistency's sake, create new variable
comprehensive_plot2 <- comprehensive

#create heatmap
p <- ggplot(comprehensive_plot2, aes(x = minplayers, y = maxplayers, fill = average)) +
  geom_tile(height = 1, width = 1) + 
  scale_fill_gradient(low = "white", high = "red")+
  labs(title = "Games supporting more players are more highly rated", 
       x = "Minimum players", 
       y = "Maximum players", 
       fill = "Average Rating") + 
  #adjust visual settings for clarity
  guides(fill = guide_colourbar(barwidth = 0.5, barheight = 8)) +
  coord_cartesian(ylim = c(1,7), xlim=c(1,5)) +
  #cap scales when data becomes too sparse
  scale_x_continuous(breaks = c(1:5)) +
  scale_y_continuous(breaks = c(1:7)) +
  theme_minimal() +
  theme(panel.grid.major = element_blank())

p
```

### Discussion

From the first plot, the red line that connects the average ratings suggests that there is a minimal relationship between the differential of players and the board game's rating. This is surprising to us because we had initially believed that games that can incorporate a wider range of people would be more popular since you would be able to play it in a greater variety of scenarios (with more or fewer players). Similarly, we noticed in the dataset that games with larger differentials were commonly classified as party games or trivia games, which we also speculated may increase their rating. We can see that the number of board game observations decreases as the differential increases, so this can explain why the trend line is less consistent as the differential increases. We speculate that there are fewer games that have greater differentials in general, so that is reflected in this dataset.

The second plot also shows a minimal relationship between the number of players and the average rating of the board game. There is a slight concentration of higher ratings with games that have higher maximum player values and lower minimum player values. Towards the outskirts of the graph, we see that most of the games are rated fairly low. This somewhat supports are initial intuitions that games that support a wider range of players are more highly rated, which may explain to some extent the higher ratings on the left side of the heatmap. However, the data is not strong enough to make any definitive conclusions.  

## Question 2: How do expansion releases correlate to rating or ownership?

### Introduction

Our second question is "How have the number of expansions for board games changed over time, and have they had an impact on game ownership count?" On an anecdotal level, we are hearing more about expansions to previously released games in recent years as a way of capitalizing on a game's popularity. We want to know whether there have been more expansions in recent years and if the number of expansions a game receives correlates with either rating or popularity (this seems like an intuitive hypothetical relationship.) We'll look at variables like the expansions a game has received, its rating, its total ownership (as an imperfect, but best available, proxy for overall popularity), and the year it was released.

### Approach

For our first visualization, we use a path diagram. We make this unconventional choice because we want to trace the progression of two continuous variables, the average rating on the y-axis and the number of expansions on the x-axis, over a time period that is independent of either axis. We start in the year 2001, which is when BoardGameGeek is launched (and thus no game is unfairly hindered by not having ratings available over its entire release lifespan) and track the games until 2019. We don't proceed until 2022 because there would naturally be fewer expansions available for newer games, which would heavily bias our data. 

For the second visualization, we decide to create boxplots to see the distribution of ownership for games with a certain number of expansions (for example, how does the distribution of games that had one expansion compare to the distribution of those with three released expansions?). We rewrite the number of expansions as a factor on the x-axis and use the log-transformation of total ownership on the y-axis. We topcode the factor at 7 expansions because the distribution of expansions is incredibly right-skewed (most games have few expansions), and too many boxplots would appear visually cluttered while the distributions themselves would mean less. We log-transform total ownership because it is similarly incredibly skewed and thus log transforming allows for greater visual clarity. This visualization could have been completed using facets (facet by the number of distributions and use density or other distribution measurements), but we believed that side-by-side boxplots captured most of the relevant data with greater clarity.

### Analysis

```{r}
#| label: annotated-path-question-2

#create expansions total in each year
comprehensive_plot3_expansions <- comprehensive |>
  mutate(expansions = str_count(boardgameexpansion, ',') + 1,
         expansions = replace_na(expansions, 0)) |>
  filter(yearpublished %in% c(2001:2019)) |>
  select(yearpublished, expansions) |>
  group_by(yearpublished) |>
  summarize(expansions_per_year = sum(expansions))

#evaluate average rating for each year
comprehensive_plot3_averages <- comprehensive |>
  filter(yearpublished %in% c(2001:2019)) |>
  select(yearpublished, average) |>
  group_by(yearpublished) |>
  summarize(yearly_avg_rating = mean(average))

#combine datasets for visualization work
comprehensive_plot3 <- comprehensive_plot3_averages |>
  left_join(comprehensive_plot3_expansions, by = "yearpublished")

#create annotations

description_2001 <- "2001: BGG goes online." |>
  str_wrap(width = 25)

description_2019 <- "2019: Games registered on BGG had an average rating of 7.25, the highest recorded thus far." |>
  str_wrap(width = 18)

description_2011 <- "2011: There's a massive increase in the number of expansions released, but average rating stays the same." |>
  str_wrap(width = 25)

#path with points and annotations highlighting specific aspects of the data
comprehensive_plot3 |>
  ggplot(aes(y = yearly_avg_rating)) +
  geom_path(aes(x = expansions_per_year)) +
  geom_point(aes(x = 1730, y = 7.252), color = "#AA330B", size = 3) +
  geom_point(aes(x = 1259, y = 6.663), color = "darkblue", size = 3) +
  geom_point(aes(x = 268, y = 6.195), color = "#228B22", size = 3) +
  labs(x = "Total Game Expansions Released", y = "Average Rating of Game",
       title = "Games' ratings and total expansions have both increased over time",
       subtitle = "But they don't show a linear relationship") +
  theme_minimal() +
  annotate("label", x = 2100, y = 7.05, label = description_2019,  size = 3, color = "#AA330B") +
  annotate("label", x = 1250, y = 6.41, label = description_2011, size = 3, color = "darkblue") +
  annotate("label", x = 400, y = 6.1, label = description_2001, size = 3, color = "#228B22")
```

```{r}
#| label: boxplots-question-2

#recoding expansions as a character variable, topcoded at 7
comprehensive_plot4 <- comprehensive |>
  #mutations to one variable done in multiple steps for code simplicity/ease of understanding
  mutate(expansions = str_count(boardgameexpansion, ',') + 1,
         expansions = replace_na(expansions, 0),
         expansions = if_else(expansions > 6, 7, expansions),
         expansions = as.character(expansions),
         expansions = str_replace(expansions, '7', '7+'))

#for data work: we saw distribution of expansion count and factored levels 0-6 and 7+ based on the fact that there were only 100+ entries for all numbers 0-6 and we didn't want an unnecessarily noisy set of boxplots. the original code is still available but has been commented out since it is not part of our final visualizations

#comprehensive_plot4 |>
  #group_by(expansions) |>
  #summarize(count = n()) |>
  #filter(count > 100)
  
#comprehensive_plot4 |>
  #ggplot(aes(x = factor(expansions))) +
  #geom_bar() +
  #scale_x_discrete(limits = c("1", "2", "3", "4", "5", "6")) +
  #geom_hline(yintercept = 100, color = "red")

#boxplot with log transformations
comprehensive_plot4 |>
  ggplot(aes(x = expansions, y = owned)) + 
  geom_boxplot() + 
  labs(x = "Number of expansions", y = "Total copies owned", 
       title = "Games with more expansions tend to be more highly owned") +
  scale_y_continuous(trans = "log10", labels = scales::comma, breaks = c(1000, 2500, 5000, 10000, 25000, 50000, 750000, 100000)) +
  theme_minimal()
```

### Discussion

In the first path diagram, we see that the total number of expansions is generally increasing year-over-year, as is the average rating of games. However, their relationship does not appear to have any specific pattern. For example, from 2011 to 2015, the average rating of games released in those years barely improved even as the number of expansions to games released in those years exploded. Of course, we would expect the correlation between these two to be loose since the number of expansions can also be explained by the time since the year of publication. Otherwise, however, the general trends in this data make sense. Games are probably becoming better as the industry expands and designers have better technology and more experience. The growing market for board games also likely explains the growth in expansions, and we expect the number of expansions for games released in a given year will change if we revisit the data several years from now. 

In the second diagram, we see differences in the distribution between games that have many expansions and games that have few. Regardless of their number of expansions, most games have little ownership; the median ownership for all categories of games was under 5,000. Almost all of the categories have very popular games, with 25,000 - 100,000 owners roughly. However, there are differences between the ownership distributions of games with 0-1 expansions and 5-7+ expansions; their medians, 25th, and 75th quartiles are all lower. This seems to imply that while there are plenty of very popular games that do not receive expansions and plenty of very popular games that receive many expansions, overall, games with fewer expansions have fewer owners generally.
