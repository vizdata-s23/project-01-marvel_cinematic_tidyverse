---
title: "Are You Board Yet?"
subtitle: "STA/ISS 313 - Project 1"
author: "Marvel Cinematic Tidyverse"
format: html
editor: visual
execute:
  echo: false
  warning: false
---

## Abstract

(1 paragraph): Project abstract.

------------------------------------------------------------------------

```{r}
#| label: load-packages
#| include: false

library(tidyverse)

```

```{r}
#| label: load-data
#| include: false
#| message : false

ratings <- read_csv('data/ratings.csv')
details <- read_csv('data/details.csv')
comprehensive <- full_join(details, ratings, by = "id") |>
  filter(owned > 500) |>
  select(-num.x, -num.y, -year, -name)
```

## Introduction

The Board Games Tidy Tuesday dataset, published on January 25th, 2022, was originally collected from [Kaggle](https://www.kaggle.com/datasets/jvanelteren/boardgamegeek-reviews?select=2022-01-08.csv). It combines board game descriptions and reviews from [Board Game Geek](https://www.boardgamegeek.com/), which is an online community for board gaming hobbyists.

With `r nrow(comprehensive)` board games, the data set includes `r ncol(comprehensive)` characteristics: `r names(comprehensive)`.

## Question 1: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the data set are necessary to answer the question. Also discuss why you're interested in this question.

Do games with larger differentials in player counts (e.g. can support a wider range of players) tend to be more highly rated?

This first question of interest will utilize the variables in the data set that represent the minimum number of players, maximum numbers of players, and average rating. We're interested in this question because we're curious whether games that accommodate for a wider number of people receive higher ratings generally or not. This could suggest that players enjoy and value the option to include more players in their game.

TO-DO: ADD PLOT 2 INTRO

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

To address this question, the first plot we made visualizes how the rating changes as the differential between the maximum and minimum number of players increases. The differential is plotted on the x-axis and the rating is plotted on the y-axis. A scatterplot is most effective in displaying all the points in order to show the audience that majority of board games have differentials of around 0 to 5 players. We combined this with a line graph because incorporating a line connecting the average rating for each differential more clearly and immediately suggests the lack of relationship between the variables of interest.

We also created a heatmap to visualize the average rating of a game based on both the minimum and maximum number of players. The minimum number of players is plotted on the x axis and the maximum number of players is plotted on the y axis with the average rating as the fill for the heatmap. The darker red the fill, the higher the average rating was for the game at that coordinate. We zoomed into the map with limits of x = (1,7) and y = (1,7) because there was not much data beyond that range. The heatmap displays similar data to the scatterplot created before, but it is still useful to support our observations in the scatterplot. A heatmap allows us to visualize minimum players, maximum players, and the average rating without creating a differential variable. This way, we do not lose information about the maximum and minimum number of players, while still gleaning information about the interaction between the two.

=======

We also created a heatmap to visualize the average rating of a game based on both the minimum and maximum number of players. The minimum number of players is plotted on the y axis and the maximum number of players is plotted on the x axis with the average rating as the fill for the heatmap. The darker red the fill, the higher the average rating was for the game at that coordinate. We zoomed into the map with limits of x = (0,12) and y = (0,5) because there was not much data beyond that range. The heatmap displays similar data to the scatterplot created before, but it is still useful to support our observations in the scatterplot. A heatmap allows us to visualize minimum players, maximum players, and the average rating without creating a differential variable. This way, we do not lose information about the maximum and minimum number of players, while still gleaning information about the interaction between the two.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r}

#| label: fig-scatter-plot-question-1

#data preparation 
#filter data for differentials between 0 and 25 
#create new variable for average rating for each differential 
comprehensive_plot1 <- comprehensive |>
  mutate(
    differential = maxplayers-minplayers
  ) |>
  filter(differential >= 0 & differential < 25) |>
  group_by(differential) |>
  mutate(
    average_rating = mean(average)
  )

#plotting each differential and its average rating with a scatter plot 
#adding layer of a line that connects each average rating per differential 
ggplot(comprehensive_plot1, aes(x=differential, y = average_rating)) +
    geom_jitter(
      colour = "gray",
      alpha = .6,
    aes(x=differential,
          y = average),
         show.legend = FALSE) +
    geom_line(
      linetype = 2,
      colour = "#FFCCCB"
      ) +
    geom_point(
      colour = "red"
    ) +
    scale_x_continuous(breaks = seq(0,25,5), minor_breaks = c(0:25)) +
    scale_y_continuous(breaks = seq(2,10,1), minor_breaks = seq(2,10,.5)) +
    labs(
      x = "Differential",
      y = "Rating",
      title = "Average Rating as Differential Increases ",
      subtitle = "Suggests Minimal Relationship") +
    theme_minimal()

```

```{r}
#| label: heat-map-question-1

#just for consistency's sake, create new variable
comprehensive_plot2 <- comprehensive

#create heatmap
p <- ggplot(comprehensive_plot2, aes(x = minplayers, y = maxplayers, fill = average)) +
  geom_tile(height = 1, width = 1) + 
  scale_fill_gradient(low = "white", high = "red")+
  labs(title = "Games supporting more players are more highly rated", 
       x = "Minimum players", 
       y = "Maximum players", 
       fill = "Average Rating") + 
  #adjust visual settings for clarity
  guides(fill = guide_colourbar(barwidth = 0.5, barheight = 8)) +
  coord_cartesian(ylim = c(1,7), xlim=c(1,5)) +
  #cap scales when data becomes too sparse
  scale_x_continuous(breaks = c(1:5)) +
  scale_y_continuous(breaks = c(1:7)) +
  theme_minimal() +
  theme(panel.grid.major = element_blank())

p
```

```{r}
#create expansions total in each year
comprehensive_plot3_expansions <- comprehensive |>
  mutate(expansions = str_count(boardgameexpansion, ',') + 1,
         expansions = replace_na(expansions, 0)) |>
  filter(yearpublished %in% c(2001:2019)) |>
  select(yearpublished, expansions) |>
  group_by(yearpublished) |>
  summarize(expansions_per_year = sum(expansions))

#evaluate average rating for each year
comprehensive_plot3_averages <- comprehensive |>
  filter(yearpublished %in% c(2001:2019)) |>
  select(yearpublished, average) |>
  group_by(yearpublished) |>
  summarize(yearly_avg_rating = mean(average))

#combine datasets for visualization work
comprehensive_plot3 <- comprehensive_plot3_averages |>
  left_join(comprehensive_plot3_expansions, by = "yearpublished")

#create annotations

description_2001 <- "2001: BGG goes online." |>
  str_wrap(width = 25)

description_2019 <- "2019: Games registered on BGG had an average rating of 7.25, the highest recorded thus far." |>
  str_wrap(width = 18)

description_2011 <- "2011: There's a massive increase in the number of expansions released, but average rating stays the same." |>
  str_wrap(width = 25)

#path with points and annotations highlighting specific aspects of the data
comprehensive_plot3 |>
  ggplot(aes(y = yearly_avg_rating)) +
  geom_path(aes(x = expansions_per_year)) +
  geom_point(aes(x = 1730, y = 7.252), color = "#AA330B", size = 3) +
  geom_point(aes(x = 1259, y = 6.663), color = "darkblue", size = 3) +
  geom_point(aes(x = 268, y = 6.195), color = "#228B22", size = 3) +
  labs(x = "Total Game Expansions Released", y = "Average Rating of Game",
       title = "Games' ratings and total expansions have both increased over time",
       subtitle = "But they don't show a linear relationship") +
  theme_minimal() +
  annotate("label", x = 2100, y = 7.05, label = description_2019,  size = 3, color = "#AA330B") +
  annotate("label", x = 1250, y = 6.41, label = description_2011, size = 3, color = "darkblue") +
  annotate("label", x = 400, y = 6.1, label = description_2001, size = 3, color = "#228B22")
```

```{r}
{r}
#| label: boxplots-question-2

#recoding expansions as a character variable, topcoded at 7
comprehensive_plot4 <- comprehensive |>
  #mutations to one variable done in multiple steps for code simplicity/ease of understanding
  mutate(expansions = str_count(boardgameexpansion, ',') + 1,
         expansions = replace_na(expansions, 0),
         expansions = if_else(expansions > 6, 7, expansions),
         expansions = as.character(expansions),
         expansions = str_replace(expansions, '7', '7+'))

#for data work: we saw distribution of expansion count and factored levels 0-6 and 7+ based on the fact that there were only 100+ entries for all numbers 0-6 and we didn't want an unnecessarily noisy set of boxplots. the original code is still available but has been commented out since it is not part of our final visualizations

#comprehensive_plot4 |>
  #group_by(expansions) |>
  #summarize(count = n()) |>
  #filter(count > 100)
  
#comprehensive_plot4 |>
  #ggplot(aes(x = factor(expansions))) +
  #geom_bar() +
  #scale_x_discrete(limits = c("1", "2", "3", "4", "5", "6")) +
  #geom_hline(yintercept = 100, color = "red")

#boxplot with log transformations
comprehensive_plot4 |>
  ggplot(aes(x = expansions, y = owned)) + 
  geom_boxplot() + 
  labs(x = "Number of expansions", y = "Total copies owned", 
       title = "Games with more expansions tend to be more highly owned") +
  scale_y_continuous(trans = "log10", labels = scales::comma, breaks = c(1000, 2500, 5000, 10000, 25000, 50000, 750000, 100000)) +
  theme_minimal()
```


### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

From the first plot, the red line that connects the average ratings suggests that there is a minimal relationship between the differential of players and the board game's rating. This is surprising to us because we had initially believed that games that can incorporate a wider range of people would be more popular, since you would be able to play it in a greater variety of scenarios (with more or less players). Similarily, we noticed in the dataset that games with larger differentials were commonly classified as party games or trivia games, which we also speculated may increase their rating. We can see that the number of board game observations decreases as the differential increases, so this can explain why the trend line is less consistent as the differential increases. We speculate that there are less games that have greater differentials in general, so that is reflected in this dataset.

The second plot also shows a minimal relationship between the number of players and the average rating of the board game. There is a slight concentration of higher ratings with games that have higher maximum player values and lower minimum player values. Towards the outskirts of the graph, we see that most of the games are rated fairly low. This somewhat supports are initial intuitions that games that support a wider range of players are more highly rated, which may explain to some extent the higher ratings on the left side of the heatmap. However, the data is not strong enough to make any definitive conclusions.  

## Question 2: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

How have the number of expansions for board games changed over time, and have they had an impact on game ownership count?

TO-DO: ADD Q2 INTRO

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

TO-DO:

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

TO-DO:

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

TO-DO:
