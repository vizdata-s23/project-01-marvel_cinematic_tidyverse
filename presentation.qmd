---
title: "Are You Board Yet?"
subtitle: "STA/ISS 313 - Spring 2023 - Project 1"
author: "Marvel Cinematic Tidyverse"
title-slide-attributes:
  data-background-image: images/watercolour_sys02_img34_teacup-ocean.jpg
  data-background-size: stretch
  data-slide-number: none
format: revealjs
editor: visual
execute:
  echo: false
  warning: false
---

```{r}
#| label: load-packages
#| include: false

# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(gt)
library(hexbin)

```

```{r}
#| label: setup
#| include: false

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r}
#| label: load-data
#| include: false
#| message : false

ratings <- readr::read_csv('data/ratings.csv')
details <- readr::read_csv('data/details.csv')
comprehensive <- full_join(details, ratings, by = "id") |>
  filter(owned > 500) |>
  select(-num.x, -num.y, -year, -name, -thumbnail, -url)
```

## Introduction

-   What do we want to write here?

-   Explain dataset or questions or both?

## Question 1, Plot 1

```{r}
#| label: scatter-plot-question-1
#| echo: false
#| warning: false
comprehensive_q1 <- comprehensive |>
  mutate(
    differential = maxplayers-minplayers
  ) |>
  filter(differential >= 0 & differential < 25) |>
  group_by(differential) |>
  mutate(
    average_rating = mean(average)
  )

  ggplot(comprehensive_q1, aes(x=differential, y = average_rating)) +
    geom_jitter(
      colour = "gray",
      alpha = .6,
    aes(x=differential,
          y = average),
         show.legend = FALSE) +
    geom_line(
      linetype = 2,
      colour = "red"
      ) +
    geom_point(
      colour = "red"
    ) +
    scale_x_continuous(breaks = seq(0,25,5), minor_breaks = c(0:25)) +
    scale_y_continuous(breaks = seq(2,10,1), minor_breaks = seq(2,10,.5)) +
    labs(
      x = "Differential",
      y = "Rating",
      title = "Average Rating as Differential Increases ",
      subtitle = "Suggests Minimal Relationship") +
    theme_minimal()
```

## Question 1, Plot 2

```{r}
#| label: heat-map-question-1
#| echo: false
#| warning: false

comprehensive_heat <- comprehensive |>
  filter(maxplayers <50)

p <- ggplot(comprehensive_heat, aes(x=maxplayers, y = minplayers, fill = average)) +
  geom_tile() + scale_fill_gradient(low = "white", high = "red")+
  labs(title = "Average Rating Based on Min and Max Players", x = "Minimum Number of Players", y = "Maximum Number of Players", fill = "Average Rating") + 
  theme_grey() + 
  guides(fill = guide_colourbar(barwidth = 0.5, barheight = 8)) +
  coord_cartesian(ylim = c(0,5), xlim=c(0,12))

p
```

## Question 2, Plot 1

```{r}
comprehensive_plot3_expansions <- comprehensive |>
  mutate(expansions = str_count(boardgameexpansion, ',') + 1,
         expansions = replace_na(expansions, 0)) |>
  filter(yearpublished %in% c(2001:2019)) |>
  select(yearpublished, expansions) |>
  group_by(yearpublished) |>
  summarize(expansions_per_year = sum(expansions))

comprehensive_plot3_averages <- comprehensive |>
  filter(yearpublished %in% c(2001:2019)) |>
  select(yearpublished, average) |>
  group_by(yearpublished) |>
  summarize(yearly_avg_rating = mean(average))

comprehensive_plot3 <- comprehensive_plot3_averages |>
  left_join(comprehensive_plot3_expansions, by = "yearpublished")

comprehensive_plot3 |>
  ggplot(aes(x = expansions_per_year, y = yearly_avg_rating)) +
  geom_path() +
  geom_point(aes(x = 2271, y = 6.766564), color = "red") +
  geom_point(aes(x = 1730, y = 7.252), color = "red") +
  labs(x = "Total Game Expansions Released", y = "Average Rating of Game")

```

## Question 2, Plot 2

```{r}
comprehensive_plot4 <- comprehensive |>
  mutate(expansions = str_count(boardgameexpansion, ',') + 1,
         expansions = replace_na(expansions, 0))

comprehensive_plot4 |>
  group_by(expansions) |>
  summarize(count = n()) |>
  filter(count > 100)

comprehensive_plot4 |>
  ggplot(aes(x = factor(expansions))) +
  geom_bar() +
  scale_x_discrete(limits = c("1", "2", "3", "4", "5", "6")) +
  geom_hline(yintercept = 100, color = "red")

comprehensive_plot4 |>
  filter(expansions < 7) |>
  ggplot(aes(x = factor(expansions), y = owned)) + 
  geom_boxplot() + 
  labs(x = "Number of expansions", y = "Total copies owned") +
  scale_y_continuous(trans = "log10", labels = scales::comma, breaks = c(1000, 2500, 5000, 10000, 25000, 50000, 750000, 100000))
  
```

## Question 2
